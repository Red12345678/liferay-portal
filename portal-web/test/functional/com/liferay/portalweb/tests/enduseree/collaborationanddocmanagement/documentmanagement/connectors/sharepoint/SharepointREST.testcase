@component-name = "portal-document-management-ee"
@ignore = "true"
definition {

	property dummy.socket.proxy.disabled = "true";
	property osgi.app.includes = "sharepoint-rest";
	property portal.ssl.enabled = "true";
	property portal.upstream = "true";
	property test.run.environment = "EE";
	property testray.main.component.name = "Documents Management";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		var authorizationGrantEndpoint = PropsUtil.get("sharepoint.oauth.authorization.grant.endpoint");
		var authorizationTokenEndpoint = PropsUtil.get("sharepoint.oauth.authorization.token.endpoint");
		var clientId = PropsUtil.get("sharepoint.oauth.client.id");
		var clientSecret = PropsUtil.get("sharepoint.oauth.client.secret");
		var configurationName = PropsUtil.get("sharepoint.oauth.configuration.name");
		var configurationResource = PropsUtil.get("sharepoint.oauth.configuration.resource");
		var configurationScope = PropsUtil.get("sharepoint.oauth.configuration.scope");
		var siteDomain = PropsUtil.get("sharepoint.oauth.site.domain");
		var tenantId = PropsUtil.get("sharepoint.oauth.tenant.id");

		ProductMenu.gotoPortlet(
			category = "Configuration",
			panel = "Control Panel",
			portlet = "System Settings");

		SystemSettings.gotoCategory(category = "Collaboration");

		SystemSettings.viewConfiguration(configurationName = "Sharepoint OAuth2");

		Click(locator1 = "Button#ADD_ENTRY");

		Type(
			key_text = "name",
			locator1 = "TextArea#ANY",
			value1 = "${configurationName}");

		Type(
			key_text = "authorizationGrantEndpoint",
			locator1 = "TextArea#ANY",
			value1 = "${authorizationGrantEndpoint}");

		Type(
			key_text = "authorizationTokenEndpoint",
			locator1 = "TextArea#ANY",
			value1 = "${authorizationTokenEndpoint}");

		Type(
			key_text = "clientId",
			locator1 = "TextArea#ANY",
			value1 = "${clientId}");

		Type(
			key_text = "clientSecret",
			locator1 = "TextArea#ANY",
			value1 = "${clientSecret}");

		Type(
			key_text = "scope",
			locator1 = "TextArea#ANY",
			value1 = "${configurationScope}");

		Type(
			key_text = "tenantId",
			locator1 = "TextArea#ANY",
			value1 = "${tenantId}");

		Type(
			key_text = "siteDomain",
			locator1 = "TextArea#ANY",
			value1 = "${siteDomain}");

		Type(
			key_text = "resource",
			locator1 = "TextArea#ANY",
			value1 = "${configurationResource}");

		Button.clickSave();

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Documents and Media");

		DMPortlet.setDescriptiveView();

		DMNavigator.gotoAddRepositoryCP();

		Type(
			key_fieldLabel = "Name",
			locator1 = "TextInput#GENERIC_TEXT_INPUT",
			value1 = "${configurationName}");

		DMRepository.addSharepoint(
			dmRepositoryLibraryPath = "Documentos compartidos",
			dmRepositoryName = "Sharepoint (${configurationName})",
			dmRepositorySiteAbsoluteURL = "https://liferaycolab.sharepoint.com");

		PortletEntry.save();

		Navigator.openSpecificURL(url = "https://localhost:8443");

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Documents and Media");

		DMPortlet.setDescriptiveView();

		AssertClick(
			key_dmRepositoryName = "${configurationName}",
			locator1 = "DocumentsAndMedia#REPOSITORY_FOLDER_NAME_DESCRIPTIVE_VIEW",
			value1 = "${configurationName}");

		MicrosoftLogin.accountSignIn();

		MicrosoftLogin.confirmSharepointApp(dmRepositoryName = "${configurationName}");

		Navigator.openSpecificURL(url = "https://localhost:8443");

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Documents and Media");
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
	}

	// LPS-87107

	@priority = "5"
	test ViewRepository {
		DMRepository.gotoCP(dmRepositoryName = "${configurationName}");

		DMRepository.viewBreadcrumb(dmRepositoryName = "${configurationName}");
	}

}